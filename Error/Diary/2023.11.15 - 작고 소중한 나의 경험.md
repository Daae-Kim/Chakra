# 2023.11.15

드디어 테스트 코드 작성을 마쳤다.

긴 시간 남의 코드를 보고 유추하고, 오류를 수정하면서 이런저런 생각이 떠올랐다.

##### 이 코드를 어떻게 개선할 수 있을까?

테스트를 까다롭게 하는것을 뽑자면 다른 함수를 의존하고 있는 함수와, new Date() 와 같이 가변하는 변수들이었다. 이것들을 코드 중간에 넣기보다

- 최대한 밖으로 빼기 -> 인자로 받기 혹은 controller 단까지 빼내기
- 의존성 주입 사용하기
- 인터페이스로 구현해서 호출하기


이 방법으로 하면 date 함수를 위해 settimeout 과 같은 함수를 쓸필요가 없고, 입력으로 받기 때문에 테스트를 할때에도 입력으로써 값을 고정해 안정적인 테스트가 가능하다.

함수가 함수를 의존하고 있지 않도록 하는게 가장 좋겠지만, 그것이 불가피 하고 테스트코드를 작성해야한다면, mockReturnValue 나 mockResolvedValue 등을 사용해서 간편하게 테스트 할 수 있다. 이번 코드작성중엔 각 객체마다 다른 값을 넣어줘야 했었는데, mockResolvedValueOnce가 아주 유용했다.

